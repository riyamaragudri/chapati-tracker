<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hostel Chapati Tracker</title>

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#c3ecff,#fce1ff);
    padding:20px;
}
.container {
    max-width:420px;
    margin:auto;
    background:#ffffff;
    padding:20px;
    border-radius:15px;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    text-align:center;
}
.datetime { font-size:14px; color:#555; margin-bottom:15px; }

button {
    padding:12px;
    margin:8px 0;
    width:100%;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
}
.yes { background:#4CAF50; color:white; }
.no { background:#f44336; color:white; }
.admin { background:#6a5acd; color:white; }
.historyBtn{ background:#ff7a18; color:white; }

input {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:1px solid #ccc;
}

.lock { color:red; font-weight:bold; margin-top:10px; }
.hidden { display:none; }

.adminBox{
    background:#f5f5ff;
    padding:10px;
    border-radius:10px;
    margin-top:10px;
    text-align:left;
    font-size:14px;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ½ï¸ Chapati Tracker</h2>

<div class="datetime">
    <div id="date"></div>
    <div id="time"></div>
</div>

<button class="yes" onclick="eatYes()">I will eat chapati</button>
<button class="no" onclick="showInput()">I will NOT eat chapati</button>

<div id="nameBox" class="hidden">
    <input type="text" id="nameInput" placeholder="Enter your name">
    <button onclick="addNotEating()">Submit</button>
</div>

<div class="adminBox">
    <b>ğŸ  Rooms Submitted â¤ï¸</b>
    <div id="publicRooms"></div>
</div>

<button class="admin" onclick="adminLogin()">Admin Login</button>

<div id="adminPanel" class="hidden">
    <h3>ğŸ¥‘ Admin Panel</h3>

    <div class="adminBox"><b>ğŸ“Š Total Chapatis:</b><div id="totalChapati"></div></div>
    <div class="adminBox"><b>ğŸ½ï¸ Room-wise:</b><div id="roomWise"></div></div>
    <div class="adminBox"><b>âŒ Not Eating:</b><div id="notEatingNames"></div></div>
    <div class="adminBox"><b>ğŸ“‰ Total Not Eating:</b><div id="totalNotEating"></div></div>

    <button class="historyBtn" onclick="toggleHistory()">ğŸ“š View Last 7 Days History</button>

    <div id="historyPanel" class="hidden adminBox">
        <b>ğŸ—‚ï¸ History (Auto deletes after 7 days)</b>
        <div id="historyData"></div>
        <button onclick="clearHistory()">ğŸ—‘ï¸ Clear All History</button>
    </div>
</div>

<div id="lockMsg" class="lock"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("chapatiData")) || [];
let history = JSON.parse(localStorage.getItem("chapatiHistory")) || [];
let isAdmin = false;

const ADMIN_PASSWORD = "5678";

/* â° LOCK TIME = 6:30 PM */
function isLocked(){
    const now = new Date();
    const lockTime = new Date();
    lockTime.setHours(18,30,0);  // 6:30 PM
    return now >= lockTime;
}

/* DATE STRING */
function todayStr(){
    return new Date().toISOString().split("T")[0];
}

/* AUTO DELETE > 7 DAYS */
function cleanHistory(){
    const now = new Date();
    history = history.filter(h=>{
        const d = new Date(h.date);
        const diff = (now - d)/(1000*60*60*24);
        return diff <= 7;
    });
    localStorage.setItem("chapatiHistory", JSON.stringify(history));
}

/* SAVE TODAY TO HISTORY */
function saveToHistory(){
    const today = todayStr();
    let entry = history.find(h=>h.date===today);
    if(!entry){
        entry = {date: today, data: []};
        history.push(entry);
    }
    entry.data = JSON.parse(JSON.stringify(data));
    localStorage.setItem("chapatiHistory", JSON.stringify(history));
    cleanHistory();
}

/* ğŸ½ï¸ EATING */
function eatYes(){
    if(isLocked()) return alert("ğŸ”’ Time up");

    const room = prompt("Enter room:");
    const count = prompt("How many people?");
    if(!room || !count || count<=0) return alert("Invalid input");

    if(data.find(d=>d.type==="eating" && d.room==room)) 
        return alert("Room already submitted");

    data.push({type:"eating",room:parseInt(room),count:parseInt(count)});
    localStorage.setItem("chapatiData", JSON.stringify(data));
    saveToHistory();
    updateUI();
}

/* âŒ NOT EATING */
function showInput(){
    if(isLocked()) return;
    document.getElementById("nameBox").classList.remove("hidden");
}

function addNotEating(){
    const name = document.getElementById("nameInput").value.trim();
    if(!name) return alert("Enter name");

    data.push({type:"not_eating",name});
    localStorage.setItem("chapatiData", JSON.stringify(data));
    saveToHistory();
    document.getElementById("nameInput").value="";
    document.getElementById("nameBox").classList.add("hidden");
    updateUI();
}

/* ğŸ‘‘ ADMIN */
function adminLogin(){
    const pass = prompt("Enter admin password:");
    if(pass===ADMIN_PASSWORD){
        isAdmin=true;
        document.getElementById("adminPanel").classList.remove("hidden");
        updateUI();
    } else alert("Wrong password");
}

/* ğŸ“š HISTORY PANEL */
function toggleHistory(){
    document.getElementById("historyPanel").classList.toggle("hidden");
    renderHistory();
}

function renderHistory(){
    let html="";
    history.sort((a,b)=> new Date(b.date)-new Date(a.date));

    history.forEach(h=>{
        html+=`<b>ğŸ“… ${h.date}</b><br>`;

        let chapatiTotal = 0;
        let notEatNames = [];

        h.data.forEach(d=>{
            if(d.type==="eating"){
                chapatiTotal += d.count;
            }
            if(d.type==="not_eating"){
                notEatNames.push(d.name);
            }
        });

        html += `ğŸ½ï¸ Chapatis: ${chapatiTotal}<br>`;
        html += `âŒ Not Eating Count: ${notEatNames.length}<br>`;

        if(notEatNames.length > 0){
            html += `ğŸ‘¤ Not Eating Names:<br>`;
            notEatNames.forEach(n=>{
                html += `â€¢ ${n}<br>`;
            });
        } else {
            html += `ğŸ‘¤ Not Eating Names: None<br>`;
        }

        html += `<hr>`;
    });

    document.getElementById("historyData").innerHTML = html || "No history";
}

function clearHistory(){
    if(confirm("Delete all history?")){
        history=[];
        localStorage.setItem("chapatiHistory","[]");
        renderHistory();
    }
}

/* UI */
function updateUI(){
    let total=0, notEat=0, roomHtml="", names=[];
    data.filter(d=>d.type==="eating").forEach(d=>{
        total+=d.count;
        roomHtml+=`â¤ï¸ Room ${d.room}: ${d.count}<br>`;
    });
    data.forEach(d=>{
        if(d.type==="not_eating"){ notEat++; names.push(d.name); }
    });

    document.getElementById("publicRooms").innerHTML = roomHtml || "No rooms yet";

    if(isAdmin){
        document.getElementById("totalChapati").innerText = total;
        document.getElementById("roomWise").innerHTML = roomHtml;
        document.getElementById("notEatingNames").innerHTML = names.join("<br>") || "No data";
        document.getElementById("totalNotEating").innerText = notEat;
    }
}

/* TIME */
function updateDateTime(){
    const now=new Date();
    document.getElementById("date").innerText="ğŸ“… "+now.toDateString();
    document.getElementById("time").innerText="ğŸ•’ "+now.toLocaleTimeString();
    document.getElementById("lockMsg").innerText = isLocked() 
        ? "ğŸ”’ Closed for today" 
        : "âœ… Open till 6:30 PM";
}

setInterval(updateDateTime,1000);
cleanHistory();
saveToHistory();   // ensures today always appears
updateUI();
updateDateTime();
</script>

</body>
</html>
