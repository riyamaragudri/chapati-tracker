<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapati Tracker</title>

<link rel="icon" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-192.png">

<meta name="theme-color" content="#ff7a18">
<link rel="manifest" href="manifest.json">

<link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#9ad1f1,#f8c1dc);
    padding:20px;
}
.container {
    max-width:500px;
    margin:auto;
    background:#ffffffcc;
    padding:25px;
    border-radius:20px;
    box-shadow:0 8px 25px rgba(0,0,0,0.2);
    text-align:center;
}
.datetime { font-size:14px; color:#555; margin-bottom:15px; }
button {
    padding:12px;
    margin:6px 0;
    width:100%;
    border:none;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
}
.yes { background:#6fcf97; }
.no { background:#f78da7; }
.admin { background:#b084cc; }
.editBtn,.deleteBtn{
    font-size:12px;
    padding:5px 8px;
    border-radius:6px;
    margin-left:5px;
    cursor:pointer;
}
.editBtn{ background:#ffd97d; }
.deleteBtn{ background:#ff7b7b; }

input{ width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }

.sectionBox{
    background:#f0f4f8;
    padding:12px;
    border-radius:12px;
    margin-top:15px;
    text-align:left;
    font-size:14px;
}
.sectionTitle{ font-weight:bold; margin-bottom:6px; }

.hidden{ display:none; }

footer {
    position: fixed;
    bottom: 14px;
    right: 20px;
    font-size: 22px;
    font-family: 'Tangerine', cursive;
    font-weight: 700;
    color: #6c63ff;
}
</style>
</head>

<body>

<div class="container">
<h2>üçΩÔ∏è Chapati Tracker</h2>

<div class="datetime">
    <div id="date"></div>
    <div id="time"></div>
</div>

<button class="yes" onclick="eatYes()">I will eat chapati ‚úÖ</button>
<button class="no" onclick="showInput()">I will NOT eat chapati ‚ùå</button>

<div id="nameBox" class="hidden">
    <input type="number" id="roomInput" placeholder="Enter room number">
    <input type="text" id="nameInput" placeholder="Enter name">
    <button onclick="addNotEating()">Submit</button>
</div>

<div class="sectionBox">
<div class="sectionTitle">üçΩÔ∏è Eating Entries</div>
<div id="eatingRooms"></div>
</div>

<div class="sectionBox">
<div class="sectionTitle">‚ùå Not Eating Entries</div>
<div id="notEatingRooms"></div>
</div>

<button class="admin" onclick="adminLogin()">Admin Login</button>

<div id="adminPanel" class="hidden">
<div class="sectionBox">
<b>Total Chapatis Needed:</b>
<div id="totalChapati"></div>
</div>

<div class="sectionBox">
<b>Room-wise Count:</b>
<div id="roomWise"></div>
</div>

<div class="sectionBox">
<b>Not Eating Names:</b>
<div id="notEatingNames"></div>
</div>

<div class="sectionBox">
<b>Total Not Eating:</b>
<div id="totalNotEating"></div>
</div>
</div>

<div id="lockMsg"></div>
</div>

<script>

/* ========== DAILY RESET LOGIC ========== */
const today = new Date().toDateString();
let savedObj = JSON.parse(localStorage.getItem("chapatiDataObj"));
let data = [];

if(savedObj && savedObj.date === today){
    data = savedObj.data;
}else{
    data = [];
    localStorage.setItem("chapatiDataObj", JSON.stringify({date: today, data: []}));
}

/* ========== HISTORY ========== */
let history = JSON.parse(localStorage.getItem("chapatiHistory")) || [];

function saveData(){
    localStorage.setItem("chapatiDataObj", JSON.stringify({
        date: new Date().toDateString(),
        data: data
    }));
    saveToHistory();
}

function cleanHistory(){
    const now = new Date();
    history = history.filter(h=>{
        const diff = (now - new Date(h.date))/(1000*60*60*24);
        return diff <= 7;
    });
    localStorage.setItem("chapatiHistory", JSON.stringify(history));
}

function saveToHistory(){
    const todayStr = new Date().toDateString();
    let entry = history.find(h=>h.date===todayStr);
    if(!entry){
        entry = {date: todayStr, data: []};
        history.push(entry);
    }
    entry.data = JSON.parse(JSON.stringify(data));
    localStorage.setItem("chapatiHistory", JSON.stringify(history));
    cleanHistory();
}

/* ========== LOCK ========== */
function isLocked(){
    const now = new Date();
    const lockTime = new Date();
    lockTime.setHours(18,30,0);
    return now >= lockTime;
}

/* ========== ACTIONS ========== */
function eatYes(){
    if(isLocked()) return alert("Time up üíó");
    const room = prompt("Enter room number:");
    const count = prompt("How many people?");
    if(!room || !count || count<=0) return alert("Invalid input");
    if(data.find(d=>d.type==="eating" && d.room==room)) return alert("Already submitted");

    data.push({type:"eating",room:parseInt(room),count:parseInt(count)});
    saveData();
    updateUI();
}

function showInput(){
    if(isLocked()) return;
    document.getElementById("nameBox").classList.remove("hidden");
}

function addNotEating(){
    const room = roomInput.value;
    const name = nameInput.value.trim();
    if(!room || !name) return alert("Fill properly");

    data.push({type:"not_eating",room:parseInt(room),name});
    roomInput.value="";
    nameInput.value="";
    nameBox.classList.add("hidden");
    saveData();
    updateUI();
}

let isAdmin=false;
function adminLogin(){
    const pass=prompt("Password:");
    if(pass==="5678"){
        isAdmin=true;
        adminPanel.classList.remove("hidden");
        updateUI();
    } else alert("Wrong password");
}

/* ========== UI ========== */
function updateUI(){
    let eatingHtml="", notEatingHtml="";
    let totalChapati=0,totalNotEating=0;
    let notEatNames=[];

    let eating=data.filter(d=>d.type==="eating").sort((a,b)=>a.room-b.room);
    eating.forEach(d=>{
        totalChapati+=d.count;
        eatingHtml+=`Room ${d.room}: ${d.count}<br>`;
    });

    let notEating=data.filter(d=>d.type==="not_eating").sort((a,b)=>a.room-b.room);
    notEating.forEach(d=>{
        totalNotEating++;
        notEatNames.push(d.name);
        notEatingHtml+=`Room ${d.room} - ${d.name}<br>`;
    });

    eatingRooms.innerHTML=eatingHtml || "No entries yet ‚ù§Ô∏è";
    notEatingRooms.innerHTML=notEatingHtml || "No entries yet ‚ùå";

    if(isAdmin){
        totalChapatiDiv = document.getElementById("totalChapati");
        roomWiseDiv = document.getElementById("roomWise");
        notEatingNamesDiv = document.getElementById("notEatingNames");
        totalNotEatingDiv = document.getElementById("totalNotEating");

        totalChapatiDiv.innerText=totalChapati;
        roomWiseDiv.innerHTML=eating.map(d=>`Room ${d.room}: ${d.count}`).join("<br>");
        notEatingNamesDiv.innerHTML=notEatNames.join("<br>");
        totalNotEatingDiv.innerText=totalNotEating;
    }
}

/* ========== DATE TIME ========== */
function updateDateTime(){
    const now=new Date();
    date.innerText="üìÖ "+now.toDateString();
    time.innerText="üïí "+now.toLocaleTimeString();
    lockMsg.innerText = isLocked()
        ? "üîí Submissions closed for today"
        : "‚úÖ Open till 6:30 PM";
}

setInterval(updateDateTime,1000);

updateUI();
updateDateTime();

</script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('service-worker.js');
  });
}
</script>

<footer>
üêæ Crafted with care by RM
</footer>

</body>
</html>      
