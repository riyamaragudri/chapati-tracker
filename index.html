<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hostel Chapati Tracker</title>

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#9ad1f1,#f8c1dc);
    padding:20px;
}
.container {
    max-width:500px;
    margin:auto;
    background:#ffffffcc;
    padding:25px;
    border-radius:20px;
    box-shadow:0 8px 25px rgba(0,0,0,0.2);
    text-align:center;
}
.datetime { font-size:14px; color:#555; margin-bottom:15px; }

button {
    padding:12px;
    margin:6px 0;
    width:100%;
    border:none;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
}
.yes { background:#6fcf97; color:#1d3557; }
.no { background:#f78da7; color:#6d4c41; }
.admin { background:#b084cc; color:#3d1766; }

.editBtn{ background:#ffd97d; color:#6b4226; font-size:12px; padding:5px 10px; border-radius:6px; margin-left:5px; cursor:pointer; }
.deleteBtn{ background:#ff7b7b; color:#690000; font-size:12px; padding:5px 10px; border-radius:6px; margin-left:5px; cursor:pointer; }

input[type="number"], input[type="text"] {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:1px solid #ccc;
}

.lock { color:#e63946; font-weight:bold; margin-top:10px; }
.hidden { display:none; }

.sectionBox{
    background:#f0f4f8;
    padding:12px;
    border-radius:12px;
    margin-top:15px;
    text-align:left;
    font-size:14px;
}
.sectionTitle{
    font-weight:bold;
    font-size:16px;
    margin-bottom:6px;
    color:#333;
}

.historyBtn{ background:#ff7a18; color:white; margin-top:10px; padding:8px; border-radius:8px; cursor:pointer; }
</style>
</head>

<body>

<div class="container">
<h2>ğŸ½ï¸ Chapati Tracker</h2>

<div class="datetime">
    <div id="date"></div>
    <div id="time"></div>
</div>

<button class="yes" onclick="eatYes()">I will eat chapati</button>
<button class="no" onclick="showInput()">I will NOT eat chapati</button>

<!-- NOT EATING INPUT -->
<div id="nameBox" class="hidden">
    <input type="number" id="roomInput" placeholder="Enter your room number" min="1">
    <input type="text" id="nameInput" placeholder="Enter your name">
    <button onclick="addNotEating()">Submit</button>
</div>

<!-- PUBLIC VIEW -->
<div class="sectionBox">
    <div class="sectionTitle">ğŸ  Rooms Submitted â¤ï¸</div>
    <div id="eatingRooms"></div>
</div>

<div class="sectionBox">
    <div class="sectionTitle">âŒ Not Eating Entries</div>
    <div id="notEatingRooms"></div>
</div>

<!-- ADMIN PANEL -->
<button class="admin" onclick="adminLogin()">Admin Login</button>

<div id="adminPanel" class="hidden">
    <h3>ğŸ¥‘ Admin Panel</h3>

    <div class="sectionBox">
        <b>ğŸ“Š Total Chapatis Needed Today â¤ï¸:</b>
        <div id="totalChapati"></div>
    </div>

    <div class="sectionBox">
        <b>ğŸ½ï¸ Room-wise Eating Count:</b>
        <div id="roomWise"></div>
    </div>

    <div class="sectionBox">
        <b>âŒ Not Eating (Room + Name):</b>
        <div id="notEatingNames"></div>
    </div>

    <div class="sectionBox">
        <b>ğŸ“‰ Total Not Eating Count:</b>
        <div id="totalNotEating"></div>
    </div>

    <button class="historyBtn" onclick="toggleHistory()">ğŸ“š View Last 7 Days History</button>

    <div id="historyPanel" class="hidden sectionBox">
        <b>ğŸ—‚ï¸ History (Auto deletes after 7 days)</b>
        <div id="historyData"></div>
        <button onclick="clearHistory()">ğŸ—‘ï¸ Clear All History</button>
    </div>
</div>

<div id="lockMsg" class="lock"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("chapatiData")) || [];
let history = JSON.parse(localStorage.getItem("chapatiHistory")) || [];
let isAdmin = false;
const ADMIN_PASSWORD = "5678";

/* â° LOCK TIME = 6:30 PM */
function isLocked(){ 
    const now = new Date();
    const lockTime = new Date();
    lockTime.setHours(19,30,0);
    return now >= lockTime;
}

/* ğŸ§¹ CLEAN HISTORY > 7 DAYS */
function cleanHistory(){
    const now = new Date();
    history = history.filter(h=>{
        const d = new Date(h.date);
        const diff = (now - d)/(1000*60*60*24);
        return diff <= 7;
    });
    localStorage.setItem("chapatiHistory", JSON.stringify(history));
}

/* ğŸ”¥ DAILY RESET SYSTEM */
function dailyResetCheck(){
    const today = new Date().toDateString();
    const lastDate = localStorage.getItem("lastActiveDate");

    if(lastDate !== today){
        // Save yesterday to history
        if(data.length > 0){
            history.push({
                date: lastDate || today,
                data: JSON.parse(JSON.stringify(data))
            });
            localStorage.setItem("chapatiHistory", JSON.stringify(history));
        }

        // Reset today's data
        data = [];
        localStorage.setItem("chapatiData", JSON.stringify([]));

        // Update active date
        localStorage.setItem("lastActiveDate", today);
    }
}

/* ğŸ½ï¸ EATING */
function eatYes(){
    if(isLocked()){ alert("Sorry, time up ğŸ’—"); return; }
    const room = prompt("Enter your room number:");
    const count = prompt("How many people are eating from this room?");
    if(!room || isNaN(room) || parseInt(room)<=0) return alert("Enter valid room number â—");
    if(!count || isNaN(count) || parseInt(count)<=0) return alert("Enter valid count â—");
    if(data.find(d=>d.type==="eating" && d.room==room)) return alert("Room already submitted");

    data.push({type:"eating",room:parseInt(room),count:parseInt(count)});
    localStorage.setItem("chapatiData", JSON.stringify(data));
    updateUI();
}

/* âŒ NOT EATING */
function showInput(){
    if(isLocked()){ alert("Sorry, time up ğŸ’—"); return; }
    document.getElementById("nameBox").classList.remove("hidden");
}

function addNotEating(){
    if(isLocked()){ alert("Sorry, time up ğŸ’—"); return; }
    const room = document.getElementById("roomInput").value.trim();
    const name = document.getElementById("nameInput").value.trim();
    if(!room || isNaN(room) || parseInt(room)<=0) return alert("Enter valid room");
    if(!name) return alert("Enter name");

    data.push({type:"not_eating",room:parseInt(room),name});
    localStorage.setItem("chapatiData", JSON.stringify(data));
    document.getElementById("roomInput").value="";
    document.getElementById("nameInput").value="";
    document.getElementById("nameBox").classList.add("hidden");
    updateUI();
}

/* ğŸ‘‘ ADMIN */
function adminLogin(){
    const pass = prompt("Enter admin password:");
    if(pass===ADMIN_PASSWORD){
        isAdmin = true;
        document.getElementById("adminPanel").classList.remove("hidden");
        updateUI();
    } else alert("Wrong password âŒ");
}

/* âœï¸ EDIT / ğŸ—‘ï¸ DELETE */
function editEating(index){
    if(isLocked()){ alert("Sorry, time up ğŸ’—"); return; }
    let item = data.filter(d=>d.type==="eating")[index];
    let room = prompt("Edit room number:", item.room);
    let count = prompt("Edit count:", item.count);
    if(!room || isNaN(room) || parseInt(room)<=0) return;
    if(!count || isNaN(count) || parseInt(count)<=0) return;
    item.room=parseInt(room);
    item.count=parseInt(count);
    localStorage.setItem("chapatiData", JSON.stringify(data));
    updateUI();
}

function editNotEating(index){
    if(isLocked()){ alert("Sorry, time up ğŸ’—"); return; }
    let items=data.filter(d=>d.type==="not_eating").sort((a,b)=>a.room-b.room);
    let item=items[index];
    let room=prompt("Edit room:",item.room);
    let name=prompt("Edit name:",item.name);
    if(!room || !name) return;
    item.room=parseInt(room);
    item.name=name;
    localStorage.setItem("chapatiData", JSON.stringify(data));
    updateUI();
}

function deleteNotEating(index){
    if(isLocked()){ alert("Sorry, time up ğŸ’—"); return; }
    let items=data.filter(d=>d.type==="not_eating").sort((a,b)=>a.room-b.room);
    let realIndex=data.indexOf(items[index]);
    if(confirm("Delete this entry?")){
        data.splice(realIndex,1);
        localStorage.setItem("chapatiData", JSON.stringify(data));
        updateUI();
    }
}

/* ğŸ“š HISTORY */
function toggleHistory(){
    document.getElementById("historyPanel").classList.toggle("hidden");
    renderHistory();
}

function renderHistory(){
    let html="";
    history.sort((a,b)=> new Date(b.date)-new Date(a.date));
    history.forEach(h=>{
        html+=`<b>ğŸ“… ${h.date}</b><br>`;
        let total=0,names=[];
        h.data.forEach(d=>{
            if(d.type==="eating") total+=d.count;
            if(d.type==="not_eating") names.push(d.name);
        });
        html+=`ğŸ½ï¸ Chapatis: ${total}<br>`;
        html+=`âŒ Not Eating Count: ${names.length}<br>`;
        if(names.length){
            html+=`ğŸ‘¤ Not Eating Names:<br>`;
            names.forEach(n=>html+=`â€¢ ${n}<br>`);
        }else{
            html+=`ğŸ‘¤ Not Eating Names: None<br>`;
        }
        html+=`<hr>`;
    });
    document.getElementById("historyData").innerHTML=html||"No history";
}

function clearHistory(){
    if(confirm("Delete all history?")){
        history=[];
        localStorage.setItem("chapatiHistory","[]");
        renderHistory();
    }
}

/* ğŸ–¥ï¸ UI */
function updateUI(){
    let eatingHtml="", notEatingHtml="";
    let totalChapati=0,totalNotEating=0,notEatNames=[];

    let eatingRooms=data.filter(d=>d.type==="eating").sort((a,b)=>a.room-b.room);
    eatingRooms.forEach((d,i)=>{
        totalChapati+=d.count;
        eatingHtml+=`â¤ï¸ Room ${d.room}: ${d.count} 
        <button class="editBtn" onclick="editEating(${i})">âœï¸ Edit</button><br>`;
    });

    let notEatingRooms=data.filter(d=>d.type==="not_eating").sort((a,b)=>a.room-b.room);
    notEatingRooms.forEach((d,i)=>{
        totalNotEating++;
        notEatNames.push(d.name);
        notEatingHtml+=`âŒ Room ${d.room} - ${d.name} 
        <button class="editBtn" onclick="editNotEating(${i})">âœï¸ Edit</button>
        <button class="deleteBtn" onclick="deleteNotEating(${i})">ğŸ—‘ï¸ Delete</button><br>`;
    });

    document.getElementById("eatingRooms").innerHTML=eatingHtml||"No eating entries yet â¤ï¸";
    document.getElementById("notEatingRooms").innerHTML=notEatingHtml||"No not eating entries yet âŒ";

    if(isAdmin){
        document.getElementById("totalChapati").innerText=totalChapati;
        document.getElementById("roomWise").innerHTML=eatingRooms.map(d=>`Room ${d.room}: ${d.count}`).join("<br>")||"No data";
        document.getElementById("notEatingNames").innerHTML=notEatNames.join("<br>")||"No data";
        document.getElementById("totalNotEating").innerText=totalNotEating;
    }
}

/* â±ï¸ DATE TIME */
function updateDateTime(){
    const now=new Date();
    document.getElementById("date").innerText="ğŸ“… "+now.toDateString();
    document.getElementById("time").innerText="ğŸ•’ "+now.toLocaleTimeString();
    document.getElementById("lockMsg").innerText=isLocked()
        ?"ğŸ”’ Submissions closed for today ğŸ’—"
        :"âœ… Submissions open till 6:30 PM â¤ï¸";
}

setInterval(updateDateTime,1000);
dailyResetCheck();   // ğŸ”¥ auto reset
cleanHistory();
updateUI();
updateDateTime();
</script>

</body>
</html>
