<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hostel Chapati Tracker</title>

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#c3ecff,#fce1ff);
    padding:20px;
}
.container {
    max-width:420px;
    margin:auto;
    background:#ffffff;
    padding:20px;
    border-radius:15px;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    text-align:center;
}
.datetime { font-size:14px; color:#555; margin-bottom:15px; }

button {
    padding:12px;
    margin:8px 0;
    width:100%;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
}
.yes { background:#4CAF50; color:white; }
.no { background:#f44336; color:white; }
.admin { background:#6a5acd; color:white; }

input {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:1px solid #ccc;
}

.lock { color:red; font-weight:bold; margin-top:10px; }
.hidden { display:none; }

/* Popup */
.popup-overlay{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.4);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:999;
}
.popup{
    background:white;
    padding:25px;
    border-radius:20px;
    text-align:center;
    width:300px;
}
.emoji{ font-size:40px; }

.adminBox{
    background:#f5f5ff;
    padding:10px;
    border-radius:10px;
    margin-top:10px;
    text-align:left;
    font-size:14px;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ½ï¸ Chapati Tracker </h2>

<div class="datetime">
    <div id="date"></div>
    <div id="time"></div>
</div>

<button class="yes" onclick="eatYes()">I will eat chapati</button>
<button class="no" onclick="showInput()">I will NOT eat chapati</button>

<!-- NOT EATING INPUT -->
<div id="nameBox" class="hidden">
    <input type="text" id="nameInput" placeholder="Enter your name">
    <button onclick="addNotEating()">Submit</button>
</div>

<!-- ROOM DISPLAY FOR ALL -->
<div class="adminBox">
    <b>ğŸ  Rooms Submitted â¤ï¸</b>
    <div id="publicRooms"></div>
</div>

<!-- ADMIN -->
<button class="admin" onclick="adminLogin()">Admin Login</button>

<div id="adminPanel" class="hidden">
    <h3>ğŸ¥‘Admin Panel</h3>

    <div class="adminBox">
        <b>ğŸ“Š Total Chapatis Needed Today â¤ï¸:</b>
        <div id="totalChapati"></div>
    </div>

    <div class="adminBox">
        <b>ğŸ½ï¸ Room-wise Eating Count:</b>
        <div id="roomWise"></div>
    </div>

    <div class="adminBox">
        <b>âŒ Not Eating (Names):</b>
        <div id="notEatingNames"></div>
    </div>

    <div class="adminBox">
        <b>ğŸ“‰ Total Not Eating Count:</b>
        <div id="totalNotEating"></div>
    </div>
</div>

<div id="lockMsg" class="lock"></div>
</div>

<!-- TIME UP POPUP -->
<div class="popup-overlay" id="popup">
    <div class="popup">
        <div class="emoji">ğŸ±</div>
        <h3>Sorry... Timeâ€™s Up!</h3>
        <p>Submissions closed after <b>6:30 PM</b> â°<br>
        Please try again tomorrow ğŸ’•</p>
        <button onclick="closePopup()">Okay ğŸ’—</button>
    </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("chapatiData")) || [];
let isAdmin = false;

const ADMIN_PASSWORD = "1234";

/* â° TIME LOCK = 6:30 PM */
function isLocked(){
    const now = new Date();
    const lockTime = new Date();
    lockTime.setHours(18,30,0); // 6:30 PM
    return now >= lockTime;
}

/* POPUP */
function showPopup(){ document.getElementById("popup").style.display = "flex"; }
function closePopup(){ document.getElementById("popup").style.display = "none"; }

/* ğŸ½ï¸ EATING (ROOM + TOTAL PEOPLE COUNT) */
function eatYes(){
    if(isLocked()){ showPopup(); return; }

    const room = prompt("Enter your room number:");
    const count = prompt("How many people are eating from this room?");

    if(!room || !count){
        alert("All fields required â—");
        return;
    }

    if(count <= 0){
        alert("Count must be more than 0 âŒ");
        return;
    }

    const exists = data.find(d => d.type==="eating" && d.room == room);

    if(exists){
        alert(" Your room counting is already submitted ğŸ \n\nIf any issue, contact mess monitor before 6:30 PM â°");
        return;
    }

    data.push({
        type: "eating",
        room: parseInt(room),
        count: parseInt(count)
    });

    localStorage.setItem("chapatiData", JSON.stringify(data));
    updateUI();

    alert("Room " + room + " submitted successfully ğŸ½ï¸â¤ï¸");
}

/* âŒ NOT EATING (NAME ONLY) */
function showInput(){
    if(isLocked()){ showPopup(); return; }
    document.getElementById("nameBox").classList.remove("hidden");
}

function addNotEating(){
    if(isLocked()){ showPopup(); return; }

    const name = document.getElementById("nameInput").value.trim();
    if(name===""){
        alert("Enter name â—");
        return;
    }

    data.push({
        type: "not_eating",
        name: name
    });

    localStorage.setItem("chapatiData", JSON.stringify(data));
    document.getElementById("nameInput").value="";
    document.getElementById("nameBox").classList.add("hidden");

    updateUI();
    alert("Submitted successfully â¤ï¸");
}

/* ğŸ‘‘ ADMIN */
function adminLogin(){
    const pass = prompt("Enter admin password:");
    if(pass === ADMIN_PASSWORD){
        isAdmin = true;
        document.getElementById("adminPanel").classList.remove("hidden");
        updateUI();
        alert("Admin mode enabled ğŸ€");
    } else {
        alert("Wrong password âŒ");
    }
}

/* UI UPDATE */
function updateUI(){
    let totalChapati = 0;
    let notEatCount = 0;

    let roomHtml = "";
    let notEatingNames = [];

    // sort rooms ascending
    let eatingRooms = data.filter(d=>d.type==="eating").sort((a,b)=>a.room-b.room);

    eatingRooms.forEach(d=>{
        totalChapati += d.count;
        roomHtml += `â¤ï¸ Room ${d.room} : ${d.count} people<br>`;
    });

    data.forEach(d=>{
        if(d.type==="not_eating"){
            notEatCount++;
            notEatingNames.push(d.name);
        }
    });

    // Public view (visible to all)
    document.getElementById("publicRooms").innerHTML = roomHtml || "No rooms submitted yet â¤ï¸";

    if(isAdmin){
        document.getElementById("totalChapati").innerText = totalChapati || 0;
        document.getElementById("roomWise").innerHTML = roomHtml || "No data";
        document.getElementById("notEatingNames").innerHTML = notEatingNames.map(n=>" "+n).join("<br>") || "No data";
        document.getElementById("totalNotEating").innerText = notEatCount;
    }
}

/* DATE TIME */
function updateDateTime(){
    const now = new Date();
    document.getElementById("date").innerText = "ğŸ“… " + now.toDateString();
    document.getElementById("time").innerText = "ğŸ•’ " + now.toLocaleTimeString();

    if(isLocked()){
        document.getElementById("lockMsg").innerText = "ğŸ”’ Submissions closed for today ğŸ±";
    } else {
        document.getElementById("lockMsg").innerText = "âœ… Submissions open till 6:30 PM â¤ï¸";
    }
}

setInterval(updateDateTime,1000);
updateUI();
updateDateTime();
</script>

</body>
</html>
